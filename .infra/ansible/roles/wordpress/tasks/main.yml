---
  - name: Update the software package repository
    command: yum update -y

  # nginx
  - name: Install nginx
    command: amazon-linux-extras install nginx1 -y

  - name: Setup nginx
    block:
      - name: Create blog.conf file
        copy:
          src: nginx/blog.conf
          dest: /etc/nginx/conf.d/blog.conf

      - name: Configure nginx to auto-start
        command: chkconfig nginx on || systemctl enable nginx.service

      - name: Update nginx.conf file
        copy:
          src: nginx/nginx.conf
          dest: /etc/nginx/nginx.conf

  #php-fpm
  - name: Install php-fpm
    command: amazon-linux-extras install php7.4 -y

  - name: Setup php-fpm
    block:
      - name: Configure php-fpm to auto-start
        command: chkconfig php-fpm on

      - name: Update www.conf file
        copy:
          src: php-fpm/www.conf
          dest: /etc/php-fpm.d/www.conf

  # restart
  - name: Restart php-fpm
    service:
      name: php-fpm
      state: restarted

  - name: Restart nginx
    service:
      name: nginx
      state: restarted
